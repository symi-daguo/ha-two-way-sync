# 更新日志

## v1.2.1 (2024-01-15)

### 🔧 重大修复
- **彻底修复调光反复开关问题**：解决了灯光亮度调节时出现的循环同步导致的反复开关问题
- **增强同步锁机制**：实现了更强大的异步锁机制，确保同步操作的原子性
- **优化防重复机制**：延长防重复间隔从3秒到5秒，方向锁定时间从2秒到3秒

### ✨ 新功能
- **智能状态变化检测**：
  - 灯光亮度变化小于5时不触发同步
  - 色温变化小于10时不触发同步
  - 风扇/空调百分比或温度变化小于2时不触发同步
  - 窗帘位置变化小于3%时不触发同步
  - 媒体播放器音量变化小于0.05时不触发同步
- **同步源跟踪机制**：区分用户操作和系统同步引起的状态变化
- **抖动检测功能**：检测并防止实体在短时间内的快速来回变化
- **状态历史记录**：保留最近5次状态变化用于分析和防抖动

### 🚀 性能优化
- **颜色等效性判断**：添加颜色容差为3的智能比较，避免微小颜色变化触发同步
- **精确同步控制**：只有在有实际属性变化时才调用设备服务
- **延迟清理机制**：同步完成后延迟1秒清除忽略标记，确保状态更新完成

### 🛠️ 代码质量提升
- **符合Home Assistant最佳实践**：
  - 完善的异常处理和错误日志记录
  - 正确的资源清理和服务注册/卸载
  - 标准的配置流程和国际化支持
- **增强的日志记录**：添加更详细的调试信息和错误追踪
- **类型安全**：改进类型注解和参数验证

### 📝 文档更新
- 更新测试指南，包含新的测试方法和调试信息
- 添加详细的版本更新说明
- 完善服务定义和配置说明

### 🔄 向后兼容性
- 保持与现有配置的完全兼容
- 所有现有功能继续正常工作
- 平滑升级，无需重新配置

---

## v1.2.0 (2024-01-10)

### 功能改进
- 优化同步逻辑
- 改进错误处理

## v1.0.11 (2024-01-05)

### 初始功能
- 基本双向同步功能
- 支持多种设备类型
- 配置流程和服务注册